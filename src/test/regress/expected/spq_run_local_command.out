CREATE SCHEMA tools;
SET SEARCH_PATH TO 'tools';
SET spq.next_shard_id TO 1240000;
SELECT * FROM spq_run_local_command(
	'SELECT 1 + 1;'
);
 spq_run_local_command
---------------------------------------------------------------------

(1 row)

SELECT * FROM spq_run_local_command(
	$$SELECT '包含中文、 单双引号'' ""、换行符\n';$$
);
 spq_run_local_command
---------------------------------------------------------------------

(1 row)

SELECT * FROM spq_run_local_command(
	'CREATE TABLE IF NOT EXISTS worker_test(id INT, note TEXT);'
);
 spq_run_local_command
---------------------------------------------------------------------

(1 row)

SELECT * FROM spq_run_local_command(
	'CREATE INDEX IF NOT EXISTS idx_note ON worker_test(note);'
);
 spq_run_local_command
---------------------------------------------------------------------

(1 row)

SELECT * FROM spq_run_local_command(
	$$INSERT INTO worker_test VALUES(1,'hello worker');$$
);
 spq_run_local_command
---------------------------------------------------------------------

(1 row)

SELECT * FROM worker_test;
 id |     note
---------------------------------------------------------------------
  1 | hello worker
(1 row)

SELECT * FROM spq_run_local_command(
	'SELECT row_to_json(worker_test) FROM worker_test LIMIT 1;'
);
 spq_run_local_command
---------------------------------------------------------------------

(1 row)

SELECT * FROM spq_run_local_command(
	'DROP TABLE IF EXISTS worker_test;'
);
 spq_run_local_command
---------------------------------------------------------------------

(1 row)

SELECT * FROM spq_run_local_command(
	$q$
	CREATE OR REPLACE FUNCTION greet(name TEXT) RETURNS TEXT AS $$
	BEGIN RETURN 'HELLO, ' || name;END;
	$$ LANGUAGE plpgsql;
	$q$
);
 spq_run_local_command
---------------------------------------------------------------------

(1 row)

SELECT * FROM spq_run_local_command(
	'SELECT greet(''spq'');'
);
 spq_run_local_command
---------------------------------------------------------------------

(1 row)

SELECT * FROM spq_run_local_command(
	$q$
	CREATE OR REPLACE PROCEDURE hello_world()
	AS
	BEGIN
		RAISE NOTICE 'Hello, openGauss!';
	END;
	$q$
);
 spq_run_local_command
---------------------------------------------------------------------

(1 row)

SELECT * FROM spq_run_local_command(
	'CALL hello_world();'
);
NOTICE:  Hello, openGauss!
CONTEXT:  SQL statement "CALL hello_world();"
PL/pgSQL function spq_run_local_command(text) line XX at EXECUTE statement
 spq_run_local_command
---------------------------------------------------------------------

(1 row)

DROP SCHEMA tools CASCADE;
NOTICE:  drop cascades to 2 other objects
DETAIL:  drop cascades to function greet(text)
drop cascades to function hello_world()
RESET SEARCH_PATH;
